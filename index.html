<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Meteora Pool Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --orange: #f44b00;
      --purple: #9f47a1;
      --red: #cc494d;
      --pink: #b64877;
      --violet: #8947cd;
      --magenta: #de492b;
      --bright-orange: #f57100;
      --text-light: #f9f9f9;
      --text-muted: #ccc;
    }

    body {
      font-family: "Inter", Arial, sans-serif;
      background: linear-gradient(135deg, var(--violet), var(--pink), var(--red));
      background-size: 200% 200%;
      animation: gradientMove 8s ease infinite;
      color: var(--text-light);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    header {
      text-align: center;
      padding: 30px 15px 15px;
    }

    header h1 {
      font-size: 1.8em;
      margin: 0;
      letter-spacing: 0.5px;
    }

    form, .controls {
      text-align: center;
      margin: 10px 10px 20px;
      flex-wrap: wrap;
    }

    input, select, button {
      padding: 10px 12px;
      margin: 5px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    input {
      width: 320px;
      max-width: 90%;
    }

    select {
      background: var(--purple);
      color: white;
      cursor: pointer;
    }

    button {
      background: var(--bright-orange);
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: var(--orange);
    }

    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      padding: 15px;
      max-width: 1100px;
      margin: auto;
    }

    .pool {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(6px);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s ease, background 0.2s ease;
      overflow-wrap: anywhere;
      word-break: break-all;
    }

    .pool:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.12);
    }

    .pool h3 {
      margin: 0 0 8px;
      font-size: 16px;
      color: var(--bright-orange);
    }

    .pool p {
      margin: 4px 0;
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.4em;
    }

    .pool strong {
      color: var(--text-light);
    }

    .copy-address {
      color: var(--bright-orange);
      cursor: pointer;
      display: inline-block;
      word-break: break-all;
      overflow-wrap: anywhere;
      max-width: 100%;
    }

    .copied {
      color: var(--orange);
      font-size: 12px;
      margin-left: 5px;
    }

    footer {
      text-align: center;
      padding: 20px 10px;
      font-size: 12px;
      color: var(--text-muted);
    }

    @media (max-width: 700px) {
      header h1 {
        font-size: 1.5em;
      }
      input, select, button {
        width: 90%;
        font-size: 13px;
      }
      .pool {
        padding: 12px;
      }
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Meteora Pool Viewer</h1>
  </header>

  <form id="form">
    <input type="text" id="tokenA" placeholder="Enter Token Address" required>
    <select id="tokenB">
      <option value="So11111111111111111111111111111111111111112">SOL</option>
      <option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC</option>
    </select>
    <button type="submit">Fetch Pools</button>
  </form>

  <div class="controls" style="display:none;" id="controls">
    <select id="sortSelect">
      <option value="">Sort by...</option>
      <option value="tvl">TVL</option>
      <option value="apr">APR</option>
      <option value="volume24h">Volume (24h)</option>
    </select>
    <select id="orderSelect">
      <option value="desc">Descending</option>
      <option value="asc">Ascending</option>
    </select>
    <label style="margin-left:10px;">
      <input type="checkbox" id="filterActive"> Show active only (TVL > 0)
    </label>
  </div>

  <div id="results"></div>

  <footer>Made by Digital Sheikh. Powered by Meteora API</footer>

  <script>
    const form = document.getElementById('form');
    const results = document.getElementById('results');
    const controls = document.getElementById('controls');
    const sortSelect = document.getElementById('sortSelect');
    const orderSelect = document.getElementById('orderSelect');
    const filterActive = document.getElementById('filterActive');
    let poolsData = [];

    async function fetchPools(tokenA, tokenB) {
      const url = `https://dammv2-api.meteora.ag/pools?token_a_mint=${tokenA}&token_b_mint=${tokenB}`;
      const options = { method: 'GET' };
      const res = await fetch(url, options);
      return res.json();
    }

    function renderPools(pools) {
      if (!pools.length) {
        results.innerHTML = "<p style='text-align:center;'>No pools found.</p>";
        return;
      }
      const collectFeeModes = { 0: "Base Token", 1: "Quote Token", 2: "Both" };

      results.innerHTML = pools.map(pool => `
        <div class="pool">
          <h3>${pool.pool_name}</h3>
          <p><strong>Pool Address:</strong><br>
            <span class="copy-address" data-address="${pool.pool_address}">${pool.pool_address}</span>
            <span class="copied" style="display:none;">Copied!</span>
          </p>
          <p><strong>Creator:</strong> ${pool.creator}</p>
          <p><strong>TVL:</strong> $${pool.tvl.toFixed(4)}</p>
          <p><strong>APR:</strong> ${pool.apr.toFixed(2)}%</p>
          <p><strong>Pool Price:</strong> ${pool.pool_price}</p>
          <p><strong>Volume 24h:</strong> $${pool.volume24h}</p>
          <p><strong>Fee Scheduler:</strong> ${pool.fee_scheduler_mode === 0 ? 'Linear' : 'Exponential'}</p>
          <p><strong>Fee 24h:</strong> $${pool.fee24h}</p>
          <p><strong>Base Fee:</strong> ${pool.base_fee}%</p>
          <p><strong>Dynamic Fee:</strong> ${pool.dynamic_fee}%</p>
          <p><strong>Collect Fee Token:</strong> ${collectFeeModes[pool.collect_fee_mode] || "Unknown"}</p>
        </div>
      `).join("");

      document.querySelectorAll(".copy-address").forEach(el => {
        el.addEventListener("click", async () => {
          const address = el.getAttribute("data-address");
          await navigator.clipboard.writeText(address);
          const copiedTag = el.nextElementSibling;
          copiedTag.style.display = "inline";
          setTimeout(() => copiedTag.style.display = "none", 1200);
        });
      });
    }

    function sortAndFilter() {
      let sorted = [...poolsData];
      const key = sortSelect.value;
      const order = orderSelect.value;
      const activeOnly = filterActive.checked;

      if (key) sorted.sort((a, b) => order === "asc" ? a[key] - b[key] : b[key] - a[key]);
      if (activeOnly) sorted = sorted.filter(p => p.tvl > 0);

      renderPools(sorted);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      results.innerHTML = "<p style='text-align:center;color:#fff;'>Loading...</p>";
      controls.style.display = "none";

      const tokenA = document.getElementById('tokenA').value.trim();
      const tokenB = document.getElementById('tokenB').value;

      try {
        const data = await fetchPools(tokenA, tokenB);
        poolsData = data.data || [];
        if (poolsData.length) controls.style.display = "block";
        renderPools(poolsData);
      } catch (err) {
        console.error(err);
        results.innerHTML = "<p style='text-align:center;'>Error fetching data.</p>";
      }
    });

    sortSelect.addEventListener('change', sortAndFilter);
    orderSelect.addEventListener('change', sortAndFilter);
    filterActive.addEventListener('change', sortAndFilter);
  </script>
</body>
</html>
